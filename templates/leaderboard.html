{% extends "base.html" %} 
{% block css %} 
{{ super() }}
{% endblock css %}

{% block view_title %}{% endblock view_title %} 

{% block main %} 
{{ super() }}

<div class="container">
  <div class="row">
    <div class="span" style='padding-bottom: 10px;'>
      <h2 class="text-center">Public Leaderboard</h2>
      <h4 class="text-center">Total Dopes and Nopes: {{ data['total_votes'] }}</h4>
    </div>
  </div>

  {% for i in data['model_indices'] %}

    <div class="row">
      <div class="col-md-4">
        <h3 class="text-center">{{i}}. <a id="model-link-{{i}}"
					  class="model-link"
					  href="{{url_for('pair_leaderboard_for_a_model', model_id=data[i]['model_name'])}}"
					  data-row-no="{{i}}"
					  data-toggle="tooltip"
					  data-placement="right"
					  data-dopes="{{ data[i]['model_matches'] }}"
					  data-nopes="{{ data[i]['model_votes'] - data[i]['model_matches'] }}"
            data-rate="{{ 'Approval Rate: {:.1f}%'.format(data[i]['model_matches']*100.0/data[i]['model_votes']) }}"
					  title="{{ data[i]['tooltip_text'] }}">{{ "{}".format(data[i]['model_name']) }}</a></h3>
      </div>
      <div class="col-md-8">
        <canvas id="approval-chart-{{i}}"></canvas>
      </div>

  {% endfor %}


</div>


<script type='text/javascript'>

  $(function(){
  $('[data-toggle="tooltip"]').tooltip({html:true, delay:{hide:1000}})
  })


  $("a.model-link").each(drawModelChart);
  
  function drawModelChart(modelLinkElement){ 
  var rowNo = $(this).data("row-no"); 
  var modelRow = $('#model-link-'+rowNo); 
  var ctx = document.getElementById('approval-chart-'+rowNo).getContext('2d'); 
  var myChart = new Chart(ctx, { 
    type: 'horizontalBar', 
    data: { labels: [''], 
    datasets: [
      { data: [modelRow.data('dopes')],
      backgroundColor: ['rgba(153, 102, 255, 0.5)'],
      label: ['Dopes']         
      },
      { data: [modelRow.data('nopes')],
      backgroundColor: ['rgba(255, 159, 64, 0.5)'],
      label: ['Nopes']       
      }]
    },
    options:{
      legend: {
        display: false
      },
      title: {
        display: true,
        text: modelRow.data('rate')
      },
      scales: {
        xAxes: [{
          ticks: {
            beginAtZero: true
          },
          stacked:true
        }],
        yAxes: [{stacked:true}]
      }
    }
  }
  ); 
  } 

</script>


{% endblock main %} 
